{% extends "base.html" %}

{% block title %}FitTrackR · Admin utilisateurs{% endblock %}

{% block page_header %}
<section class="page-hero">
  <p class="eyebrow">Administration</p>
  <h1 class="page-title">Utilisateurs</h1>
  <p class="lead">Gère les rôles, abonnements et informations des comptes.</p>
</section>
{% endblock %}

{% block sidebar %}{% endblock %}

{% block content %}
<div class="card">
  <div class="card-head">
    <div>
      <p class="eyebrow">Gestion</p>
      <h2>Liste des utilisateurs</h2>
    </div>
    <div style="display:flex; align-items:center; gap:8px; flex-wrap:wrap;">
      <form method="get" style="display:flex; gap:8px; align-items:center;">
        <input
          type="search"
          name="q"
          placeholder="Rechercher (nom, email, rôle)"
          value="{{ search_query }}"
          class="control"
          style="min-width: 220px;"
        />
        <button type="submit" class="btn ghost">Rechercher</button>
        {% if search_query %}
          <a class="btn ghost" href="{% url 'admin_users_list' %}">Réinitialiser</a>
        {% endif %}
      </form>
      <span class="pill small">
        {{ results_count }} résultat{{ results_count|pluralize }} / {{ total_count }} total
      </span>
    </div>
  </div>

  {% if users %}
  <div class="split-grid">
    {% for u in users %}
      <div class="split-panel">
        <div class="card-head">
          <div>
            <p class="eyebrow">{{ u.get_role_display }}</p>
            <h3 style="margin: 6px 0 2px;">{{ u.username }}</h3>
            <p class="muted" style="margin: 0;">{{ u.email }}</p>
          </div>
          {% if u.subscription %}
            <span class="pill small">{{ u.subscription.name }}</span>
          {% else %}
            <span class="pill small">Sans abonnement</span>
          {% endif %}
        </div>
        <div class="profile-grid">
          <div>
            <p class="muted">Âge</p>
            <strong>{{ u.age|default:"-" }}</strong>
          </div>
          <div>
            <p class="muted">Poids</p>
            <strong>{% if u.weight %}{{ u.weight }} kg{% else %}-{% endif %}</strong>
          </div>
          <div>
            <p class="muted">Taille</p>
            <strong>{% if u.size %}{{ u.size }} cm{% else %}-{% endif %}</strong>
          </div>
        </div>
        <div class="profile-actions">
          <a class="btn ghost" href="{% url 'admin_user_edit' u.id %}">Modifier</a>
        </div>
      </div>
    {% endfor %}
  </div>
  {% else %}
    {% if search_query %}
      <div class="alert warning">Aucun résultat pour « {{ search_query }} ».</div>
    {% else %}
      <p class="muted">Aucun utilisateur pour le moment.</p>
    {% endif %}
  {% endif %}
</div>
{% endblock %}
